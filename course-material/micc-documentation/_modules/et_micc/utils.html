

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>et_micc.utils &mdash; et_micc 1.0.18 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> et_micc
          

          
          </a>

          
            
            
              <div class="version">
                1.0.18
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">Micc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apps.html">Applications (CLI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devenv.html">Development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../links.html">Interesting links on Python programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">History</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">et_micc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>et_micc.utils</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for et_micc.utils</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on 18 Nov 2019</span>

<span class="sd">@author: etijskens</span>

<span class="sd">Module et_micc.utils</span>
<span class="sd">====================</span>

<span class="sd">Utility functions for et_micc.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>

<span class="kn">import</span> <span class="nn">semantic_version</span> <span class="k">as</span> <span class="nn">sv</span>

<span class="kn">from</span> <span class="nn">et_micc.tomlfile</span> <span class="kn">import</span> <span class="n">TomlFile</span>
<span class="kn">import</span> <span class="nn">et_micc.logger</span>

<span class="kn">from</span> <span class="nn">pypi_simple</span> <span class="kn">import</span> <span class="n">PyPISimple</span>


<div class="viewcode-block" id="operator_version"><a class="viewcode-back" href="../../api.html#et_micc.utils.operator_version">[docs]</a><span class="k">def</span> <span class="nf">operator_version</span><span class="p">(</span><span class="n">version_constraint_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split version_constraint_string in operator and version.</span>

<span class="sd">    :returns: (str,semantic_version.Version)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">version_constraint_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="n">operator</span> <span class="o">=</span> <span class="n">version_constraint_string</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">operator</span><span class="p">:</span>
                <span class="n">operator</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="n">Version</span><span class="p">(</span><span class="n">version_constraint_string</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">operator</span> <span class="o">=</span> <span class="n">version_constraint_string</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">version</span>  <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="n">Version</span><span class="p">(</span><span class="n">version_constraint_string</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">operator</span><span class="p">,</span><span class="n">version</span><span class="p">)</span></div>


<div class="viewcode-block" id="version_range"><a class="viewcode-back" href="../../api.html#et_micc.utils.version_range">[docs]</a><span class="k">def</span> <span class="nf">version_range</span><span class="p">(</span><span class="n">version_constraint_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return interval [lower_bound,upper_bound[ as a tuple for a given version constraint.</span>
<span class="sd">    </span>
<span class="sd">    Note that the lower bound is inclusive, but the upper bound is exclusive.</span>
<span class="sd">    If one of the bounds is None, then it is unbound in that direction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">version_constraint_string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="p">):</span>
        <span class="n">vc</span> <span class="o">=</span> <span class="n">version_constraint_string</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">vn</span> <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="n">Version</span><span class="p">(</span><span class="n">vc</span><span class="p">)</span><span class="o">.</span><span class="n">next_major</span><span class="p">()</span>
        <span class="n">version_constraint_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&gt;=</span><span class="si">{</span><span class="n">vc</span><span class="si">}</span><span class="s2">,&lt;</span><span class="si">{</span><span class="n">vn</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">version_constraint_string</span><span class="p">:</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="n">version_constraint_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">bnds</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">version_range</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span>
            <span class="n">bnds</span> <span class="o">=</span> <span class="n">intersect</span><span class="p">(</span><span class="n">bnds</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bnds</span>
        
    <span class="n">operator</span><span class="p">,</span><span class="n">version</span> <span class="o">=</span> <span class="n">operator_version</span><span class="p">(</span><span class="n">version_constraint_string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">version</span><span class="o">.</span><span class="n">next_patch</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="o">.</span><span class="n">next_patch</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">version</span><span class="o">.</span><span class="n">next_patch</span><span class="p">(),</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="n">version</span><span class="p">)</span></div>
    

<span class="k">def</span> <span class="nf">largest_lower_bound</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
    <span class="c1"># None is always smaller</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">l</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">r</span> <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">l</span>

        
<span class="k">def</span> <span class="nf">smallest_upper_bound</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
    <span class="c1"># None is always larger</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">l</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">l</span> <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">r</span>

        
<div class="viewcode-block" id="intersect"><a class="viewcode-back" href="../../api.html#et_micc.utils.intersect">[docs]</a><span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="n">version_range_1</span><span class="p">,</span> <span class="n">version_range_2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the intersection of two version ranges&quot;&quot;&quot;</span>
    <span class="n">llb</span> <span class="o">=</span> <span class="n">largest_lower_bound</span> <span class="p">(</span><span class="n">version_range_1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">version_range_2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sub</span> <span class="o">=</span> <span class="n">smallest_upper_bound</span><span class="p">(</span><span class="n">version_range_1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">version_range_2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">llb</span><span class="p">,</span><span class="n">sub</span><span class="p">)</span></div>


<div class="viewcode-block" id="validate_intersection"><a class="viewcode-back" href="../../api.html#et_micc.utils.validate_intersection">[docs]</a><span class="k">def</span> <span class="nf">validate_intersection</span><span class="p">(</span><span class="n">intersection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test if the intersection is not empty.</span>
<span class="sd">    :returns: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">intersection</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">intersection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="n">intersection</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span></div>


<span class="k">def</span> <span class="nf">most_recent</span><span class="p">(</span><span class="n">version_constraint_string1</span><span class="p">,</span> <span class="n">version_constraint_string2</span><span class="p">):</span>
    <span class="n">range1</span> <span class="o">=</span> <span class="n">version_range</span><span class="p">(</span><span class="n">version_constraint_string1</span><span class="p">)</span>
    <span class="n">range2</span> <span class="o">=</span> <span class="n">version_range</span><span class="p">(</span><span class="n">version_constraint_string2</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">range1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">range2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sv</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">range1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">range2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">version_constraint</span><span class="p">(</span><span class="n">range2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">range2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">range1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sv</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">range2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">range1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">version_constraint</span><span class="p">(</span><span class="n">range1</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: </span><span class="si">{</span><span class="n">range1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">range2</span><span class="si">}</span><span class="s2"> intersect.&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="version_constraint"><a class="viewcode-back" href="../../api.html#et_micc.utils.version_constraint">[docs]</a><span class="k">def</span> <span class="nf">version_constraint</span><span class="p">(</span><span class="n">version_range</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a version_range to a version constraing string&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&gt;=</span><span class="si">{</span><span class="n">version_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">,&lt;</span><span class="si">{</span><span class="n">version_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span></div>


<span class="k">def</span> <span class="nf">convert_caret_specification</span><span class="p">(</span><span class="n">spec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">vlower</span> <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="n">Version</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">vupper</span> <span class="o">=</span> <span class="n">vlower</span><span class="o">.</span><span class="n">next_major</span><span class="p">()</span>
        <span class="n">new_spec</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&gt;=</span><span class="si">{</span><span class="n">vlower</span><span class="si">}</span><span class="s2">,&lt;</span><span class="si">{</span><span class="n">vupper</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">new_spec</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">spec</span>

<div class="viewcode-block" id="replace_in_file"><a class="viewcode-back" href="../../api.html#et_micc.utils.replace_in_file">[docs]</a><span class="k">def</span> <span class="nf">replace_in_file</span><span class="p">(</span><span class="n">file_to_search</span><span class="p">,</span> <span class="n">look_for</span><span class="p">,</span> <span class="n">replace_with</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Replace the text :py:obj:`look_for` with :py:obj:`replace_with` in file :file:`file_to_search`&quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_to_search</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">look_for</span><span class="p">,</span> <span class="n">replace_with</span><span class="p">)</span>
    <span class="n">path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>


<div class="viewcode-block" id="verify_project_name"><a class="viewcode-back" href="../../api.html#et_micc.utils.verify_project_name">[docs]</a><span class="k">def</span> <span class="nf">verify_project_name</span><span class="p">(</span><span class="n">project_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Project names must start with a char, and contain only chars, digits, underscores and dashes.</span>
<span class="sd">    </span>
<span class="sd">    :returns: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;\A[a-zA-Z][a-zA-Z0-9_-]*\Z&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span> <span class="p">)</span></div>
    
    
<div class="viewcode-block" id="pep8_module_name"><a class="viewcode-back" href="../../api.html#et_micc.utils.pep8_module_name">[docs]</a><span class="k">def</span> <span class="nf">pep8_module_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a module name to a PEP8 compliant module name.</span>
<span class="sd">    </span>
<span class="sd">    * lowercase</span>
<span class="sd">    * whitespace -&gt; underscore </span>
<span class="sd">    * dash -&gt; underscore </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">name</span>
    
    <span class="n">valid_module_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>            
    
    <span class="k">return</span> <span class="n">valid_module_name</span></div>


<div class="viewcode-block" id="existsOnPyPI"><a class="viewcode-back" href="../../api.html#et_micc.utils.existsOnPyPI">[docs]</a><span class="k">def</span> <span class="nf">existsOnPyPI</span><span class="p">(</span><span class="n">package</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Does package exist already on PyPI?</span>

<span class="sd">    :return: True|False|Exception`</span>

<span class="sd">    In case of an exception, the result is inconclusive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">PyPISimple</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="n">requests_page</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_project_page</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">e</span>

    <span class="k">return</span> <span class="ow">not</span> <span class="n">requests_page</span> <span class="ow">is</span> <span class="kc">None</span></div>

<span class="c1"># &#39;pip search name&#39; will soon disappear</span>
<span class="c1"># seehttps://stackoverflow.com/questions/65307988/error-using-pip-search-pip-search-stopped-working</span>
<span class="c1"># def is_publishable(package_name, verbose=True):</span>
<span class="c1">#     &quot;&quot;&quot;Is the name &lt;package_name&gt; available for publishing on PyPI?</span>
<span class="c1">#</span>
<span class="c1">#     This is achieved by running ``pip search &lt;package_name&gt;`` and examining the output. If</span>
<span class="c1">#     &lt;package_name&gt; is in use, it will appear in the output.</span>
<span class="c1">#</span>
<span class="c1">#     :param str package_name: name of the package for which we want to verify the availability.</span>
<span class="c1">#     :param bool verbose: show the output of ``pip search &lt;package_name&gt;`` and the examination</span>
<span class="c1">#         process.</span>
<span class="c1">#</span>
<span class="c1">#     :returns: the answer as a bool, if the command ``pip search &lt;package_name&gt;`` was successful,</span>
<span class="c1">#         and None otherwise (e.g. because of no connection).</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#     # We are using subprocess to run &#39;pip search&#39; because if we use pip as a module</span>
<span class="c1">#     # the output cannot be suppressed in case of an error</span>
<span class="c1">#</span>
<span class="c1">#     cmd = [&#39;pip&#39;, &#39;search&#39;, package_name]</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(</span>
<span class="c1">#             f&quot;Verifying the availability of name &#39;{package_name}&#39; on PyPI.\n&quot;</span>
<span class="c1">#             f&quot;  Running: &#39;{&#39; &#39;.join(cmd)}&#39;&quot;</span>
<span class="c1">#         )</span>
<span class="c1">#     try:</span>
<span class="c1">#         # python &gt;=3.7</span>
<span class="c1">#         completed_process = subprocess.run(cmd, capture_output=True)</span>
<span class="c1">#     except:</span>
<span class="c1">#         # python &lt;3.7, e.g 3.6.9:</span>
<span class="c1">#         #   capture_output parameter does not exist.</span>
<span class="c1">#         completed_process = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)</span>
<span class="c1">#</span>
<span class="c1">#     if completed_process.returncode:</span>
<span class="c1">#         if verbose:</span>
<span class="c1">#             print(completed_process.stderr.decode(&#39;utf-8&#39;))</span>
<span class="c1">#             print(f&quot;\nRunning: &#39;{&#39; &#39;.join(cmd)}&#39; FAILED!&quot;)</span>
<span class="c1">#         return None</span>
<span class="c1">#</span>
<span class="c1">#     if verbose:</span>
<span class="c1">#         print(f&quot;  Examining the output of &#39;pip search {package_name}&#39;:&quot;)</span>
<span class="c1">#     lines = completed_process.stdout.decode(&#39;utf-8&#39;).split(&#39;\n&#39;)</span>
<span class="c1">#     for line in lines:</span>
<span class="c1">#         words = line.split(&#39; &#39;)</span>
<span class="c1">#         package = words[0]</span>
<span class="c1">#         if verbose:</span>
<span class="c1">#             print(f&quot;    found &#39;{package}&#39; : {package_name==package}&quot;)</span>
<span class="c1">#         if package_name == package:</span>
<span class="c1">#             return False</span>
<span class="c1">#     return True</span>


<div class="viewcode-block" id="is_project_directory"><a class="viewcode-back" href="../../api.html#et_micc.utils.is_project_directory">[docs]</a><span class="k">def</span> <span class="nf">is_project_directory</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">project</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Verify that the directory :file:`path` is a project directory. </span>
<span class="sd">    </span>
<span class="sd">    :param Path path: path to a directory.</span>
<span class="sd">    :param Project project: if not None these variables are set:</span>

<span class="sd">        * project.project_name</span>
<span class="sd">        * project.package_name</span>
<span class="sd">        * project.pyproject_toml</span>

<span class="sd">    :returns: bool.</span>
<span class="sd">    </span>
<span class="sd">    As a sufficident condition, we request that </span>
<span class="sd">    </span>
<span class="sd">    * there is a pyproject.toml file, exposing the project&#39;s name:py:obj:`[&#39;tool&#39;][&#39;poetry&#39;][&#39;name&#39;]`</span>
<span class="sd">    * that there is a python package or module with that name, converted by :py:meth:`pep8_module_name`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        
    <span class="n">path_to_pyproject_toml</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span><span class="s1">&#39;pyproject.toml&#39;</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pyproject_toml</span> <span class="o">=</span> <span class="n">TomlFile</span><span class="p">(</span><span class="n">path_to_pyproject_toml</span><span class="p">)</span>
        <span class="n">project_name</span> <span class="o">=</span> <span class="n">pyproject_toml</span><span class="p">[</span><span class="s1">&#39;tool&#39;</span><span class="p">][</span><span class="s1">&#39;poetry&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">project</span><span class="o">.</span><span class="n">pyproject_toml</span> <span class="o">=</span> <span class="n">pyproject_toml</span>
            <span class="n">project</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">verify_project_structure</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">project</span><span class="p">)</span></div>


<div class="viewcode-block" id="verify_project_structure"><a class="viewcode-back" href="../../api.html#et_micc.utils.verify_project_structure">[docs]</a><span class="k">def</span> <span class="nf">verify_project_structure</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">project</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Verify that there is either a Python module :file:`&lt;package_name&gt;.py`, or</span>
<span class="sd">    a package :file:`&lt;package_name&gt;/__init__.py` (and not both).</span>
<span class="sd">    </span>
<span class="sd">    :returns: a list with what was found. This list should have length 1. If its </span>
<span class="sd">        length is 0, neither module.py, nor module/__init__.py were found. If its </span>
<span class="sd">        length is 2, both were found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">package_name</span> <span class="o">=</span> <span class="n">pep8_module_name</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    
    <span class="n">module</span> <span class="o">=</span> <span class="n">path</span> <span class="o">/</span> <span class="p">(</span><span class="n">package_name</span> <span class="o">+</span> <span class="s2">&quot;.py&quot;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="n">package</span> <span class="o">=</span> <span class="n">path</span> <span class="o">/</span> <span class="n">package_name</span> <span class="o">/</span> <span class="s2">&quot;__init__.py&quot;</span>
    <span class="n">package</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">if</span> <span class="n">package</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">package</span> <span class="ow">and</span> <span class="n">module</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">project</span><span class="p">:</span>
            <span class="n">project</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Package (</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">/__init__.py) and module (</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">.py) found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">module</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">package</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">project</span><span class="p">:</span>
            <span class="n">project</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Neither package (</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">/__init__.py) nor module (</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">.py) found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">project</span><span class="p">:</span>
            <span class="n">project</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="s1">&#39;module&#39;</span> <span class="k">if</span> <span class="n">module</span> <span class="k">else</span> <span class="s1">&#39;package&#39;</span>
            <span class="n">project</span><span class="o">.</span><span class="n">src_file</span> <span class="o">=</span> <span class="n">module</span> <span class="k">if</span> <span class="n">module</span> <span class="k">else</span> <span class="n">package</span>
            <span class="n">project</span><span class="o">.</span><span class="n">package_name</span> <span class="o">=</span> <span class="n">package_name</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="in_directory"><a class="viewcode-back" href="../../api.html#et_micc.utils.in_directory">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">in_directory</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Context manager for changing the current working directory while the body of the</span>
<span class="sd">    context manager executes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">previous_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="c1"># the str method takes care of when path is a Path object</span>
    <span class="k">yield</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">previous_dir</span><span class="p">)</span></div>


<div class="viewcode-block" id="execute"><a class="viewcode-back" href="../../api.html#et_micc.utils.execute">[docs]</a><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">cmds</span><span class="p">,</span><span class="n">logfun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stop_on_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cwd</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Executes a list of OS commands, and logs with logfun.</span>
<span class="sd">    </span>
<span class="sd">    :param list cmds: list of OS commands (=list of list of str) or a single command (list of str)</span>
<span class="sd">    :parma callable logfun: a function to write output, typically </span>
<span class="sd">        ``logging.getLogger(&#39;et_micc&#39;).debug``.</span>
<span class="sd">    :returns int: return code of first failing command, or 0 if all</span>
<span class="sd">        commanbds succeed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
        <span class="c1"># this is a single command</span>
        <span class="n">cmds</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmds</span><span class="p">]</span>
        
    <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">cmds</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">et_micc</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logfun</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;&gt; </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># python &gt;=3.7</span>
                <span class="n">completed_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span><span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># python &lt;3.7, e.g 3.6.9:</span>
                <span class="c1">#   capture_output parameter does not exist.</span>
                <span class="n">completed_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">,</span>
                    <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">logfun</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">completed_process</span><span class="o">.</span><span class="n">returncode</span><span class="p">:</span>
                    <span class="n">logfun0</span> <span class="o">=</span> <span class="n">logfun</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">logfun</span> <span class="o">=</span> <span class="n">logfun</span><span class="o">.</span><span class="vm">__self__</span><span class="o">.</span><span class="n">warning</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="n">logfun</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt; </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">completed_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
                    <span class="n">logfun</span><span class="p">(</span><span class="s1">&#39; (stdout)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">completed_process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">completed_process</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
                    <span class="n">logfun</span><span class="p">(</span><span class="s1">&#39; (stderr)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">completed_process</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">completed_process</span><span class="o">.</span><span class="n">returncode</span><span class="p">:</span>
                    <span class="n">logfun</span> <span class="o">=</span> <span class="n">logfun0</span>
            <span class="k">if</span> <span class="n">completed_process</span><span class="o">.</span><span class="n">returncode</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stop_on_error</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">completed_process</span><span class="o">.</span><span class="n">returncode</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="get_project_path"><a class="viewcode-back" href="../../api.html#et_micc.utils.get_project_path">[docs]</a><span class="k">def</span> <span class="nf">get_project_path</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Look for a project directory in the parents of path :py:obj:`p`.</span>
<span class="sd">    </span>
<span class="sd">    :param Path p:</span>
<span class="sd">    :returns: the nearest directory above :py:obj:`p` that is project directory.</span>
<span class="sd">    :raise: RuntimeError if :py:obj:`p` is noe inside a project directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">is_project_directory</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">==</span><span class="n">root</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">p0</span><span class="si">}</span><span class="s2"> is not inside a Python project.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span></div>


<div class="viewcode-block" id="insert_in_file"><a class="viewcode-back" href="../../api.html#et_micc.utils.insert_in_file">[docs]</a><span class="k">def</span> <span class="nf">insert_in_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="p">[],</span> <span class="n">before</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">startswith</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Insert *lines* at a specific position in a &lt;file&gt;.</span>
<span class="sd">    </span>
<span class="sd">    :param Path file: path to file in which to insert</span>
<span class="sd">    :param list lines: list of lines to insert. If a line does not end with </span>
<span class="sd">        a newline, it is added.</span>
<span class="sd">    :param bool before: insert before or after a reference line.</span>
<span class="sd">    :param str startswith: find the reference line as the first line that</span>
<span class="sd">        starts with &lt;startswith&gt;. If no such line is found the text is inserted</span>
<span class="sd">        at the end.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">startswith</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">startswith</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">before</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">break</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">content</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>
        
    
<span class="c1">#eof</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Engelbert Tijskens

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>